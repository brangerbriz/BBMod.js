<!DOCTYPE html>
<html>
	<head>
		<title>whtieboard</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<style>

    		* { margin: 0; padding: 0; box-sizing: border-box; }
			body { 
				font: 13px Helvetica, Arial; 
				-webkit-touch-callout: none;
			    -webkit-user-select: none;
			    -khtml-user-select: none;
			    -moz-user-select: none;
			    -ms-user-select: none;
			    user-select: none;
			    background-color: #99cc32;
			}
			canvas { position: absolute; z-index: 1; top:0px; bottom:0px; }

			#start{
				width: 100%;
				height:100%;
				text-align: center;
				background: #fff;
				position: fixed; top:0px; left:0px; z-index: 10;
			}
			#splash {
				display: block;
				width:481px;
				margin:30px auto;
			}
			#login { 
				width:240px; 
				margin: 0 auto;
				background: #fff;
				border: 1px solid #ccc;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
				border-radius: 5px;
				font-size: 24px; 
				padding: 10px;
			}
			#signin { 
				width:100px; 
				margin: 0 auto;
				background: #fff;
				border: 1px solid #ccc;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
				border-radius: 5px;
				font-size: 24px; 
				padding: 10px;
			}

			#userList{ position: absolute; z-index: 3; }

			#colorlayer {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: 9;
				display: none;
				/*cursor:url(images/swatch.png), auto;*/
			}
			#sizePicker {
				position: absolute;
				z-index: 9;
				width:102px;
				height:101px;
				left:50%;
				top:50%;
				margin-left: -50px;
				margin-top: -50px;
				display: none;
			}
			
			#colbar {
    		background: red; /* not working, let's see some red */
			    background: -moz-linear-gradient( top ,
			        rgba(255, 0, 0, 1) 0%,
			        rgba(255, 255, 0, 1) 15%,
			        rgba(0, 255, 0, 1) 30%,
			        rgba(0, 255, 255, 1) 50%,
			        rgba(0, 0, 255, 1) 65%,
			        rgba(255, 0, 255, 1) 80%,
			        rgba(255, 0, 0, 1) 100%);
			    background: -webkit-gradient(linear,  left top,  left bottom, 
			        color-stop(0%, rgba(255, 0, 0, 1)), 
			        color-stop(15%, rgba(255, 255, 0, 1)),
			        color-stop(30%, rgba(0, 255, 0, 1)),
			        color-stop(50%, rgba(0, 255, 255, 1)),
			        color-stop(65%, rgba(0, 0, 255, 1)),
			        color-stop(80%, rgba(255, 0, 255, 1)),
			        color-stop(100%, rgba(255, 0, 0, 1)));
			}
			#colbar { position: fixed; z-index: 5; top: 0; left: 0; height: 100%; width: 20px;display:none; cursor:crosshair;}
			
			#toolbar { position: fixed; z-index: 4; bottom: 20px; left: 0; text-align: center; width: 100%; display:none; }
			.icon { padding: 10px; cursor: pointer; opacity: 0.5 }
			.submenu { display: inline-block; }
			.sub { padding:5px; cursor:pointer; width:65px; opacity: 0.5}
			b { font-weight: bold}



    	</style>
	</head>
	<body>



		<div class="loader">loading</div>


		<!-- tools menu -->
		<div id="colbar"></div>
		<div id="toolbar">
			<img src="images/pen.png" id="pen" class="icon" style="opacity:1">
			<div id="submenu-pen" class="submenu">
				<img src="images/pensolid.png" class="sub" id="pensolid" style="opacity:1">
				<img src="images/pensoft.png" class="sub" id="pensoft"><br>
				<img src="images/pencalig.png" class="sub" id="pencalig">
				<img src="images/penlines.png" class="sub" id="penlines">
			</div>
			<img src="images/stamp.png" id="stamp" class="icon">
			<div id="submenu-stamp" class="submenu">
				<img src="images/stampcircles.png" class="sub" id="stampcircles" style="opacity:1">
				<img src="images/stampcircslash.png" class="sub" id="stampcircslash">
				<img src="images/stampcube.png" class="sub" id="stampcube"><br>
				<img src="images/stampflames.png" class="sub" id="stampflames">			
				<img src="images/stampgrid.png" class="sub" id="stampgrid">
				<img src="images/stampheart.png" class="sub" id="stampheart"><br>
				<img src="images/stamplocking.png" class="sub" id="stamplocking">			
				<img src="images/stampseal.png" class="sub" id="stampseal">
				<img src="images/stampstar.png" class="sub" id="stampstar">
			</div>
			<img src="images/eraser.png" id="eraser" class="icon">
			<img src="images/missing.png" id="colorpicker" class="icon">
		</div>

		
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js" type="text/javascript"><\/script>')</script>
		<script src="../../../build/BB.min.js"></script>
		<script>

			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.  MAIN COURSE   _.~*~._.~*~._.~*~._.~*~._ \\
			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._ \\
			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._ \\


			// surface -----------------

			var canvas = document.createElement('canvas');
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
			document.body.appendChild( canvas );
	
			ctx = canvas.getContext('2d');


			// ingredients -----------------
			// 
			var mouse = new BB.MouseInput( canvas );
			 pointer = new BB.Pointer( mouse );
			// var brushManager = new BB.BrushManager2D( canvas );
       		 	// brushManager.trackPointers([pointer]);

       		 pen = new BB.LineBrush2D({
	            color: new BB.Color(),
	            weight: 20,
	            variant: "solid"
	            // manager: brushManager
	        });

       		 stamp = new BB.ImageBrush2D({ 
       		 	color: new BB.Color(),
       		 	width: 100,
				height: 100, 
				// src: "http://some/image.png" 
				variant: "circles"
			});

       		// recipe ----------------------

			function setup(){
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
			}

			function update(){
				// requestAnimationFrame( update );

				mouse.update();
		        pointer.update();
		        // brushManager.update();
		        pen.update( pointer );
		        stamp.update( pointer );
			}


			function draw(){
				// ctx.clearRect(0, 0, canvas.width, canvas.height);

				if( currentTool == "pen" ) 			pen.draw( ctx );
		        else if( currentTool == "stamp" ) 	stamp.draw( ctx );
		        else if( currentTool == "eraser" ) 	pen.draw( ctx );
		        
		        // brushManager.draw( ctx );
			}

			// cook it --------------------- 

			$(document).ready(function(){
				
				$('.loader').fadeOut();
				setup();
				draw();
				window.onresize = setup();

			});	

			// document.onmousemove = function(){
			//   	update();
			//   	draw();
			// }

			setInterval(function(){
				update();
				draw();
			},1000/60);


			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~.   EVENTS   _.~*~._.~*~._.~*~._.~*~._ \\
			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._ \\
			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._ \\


			var mouseidle;

			pointer.on('movestart', function(x, y){

		        $('#toolbar').fadeIn();
		        $('#colbar').fadeIn();
		        clearTimeout( mouseidle );

		    });

		    pointer.on('movestop', function(x, y){

		        mouseidle = setTimeout(function(){
		        	$('#toolbar').fadeOut();
		        	$('#colbar').fadeOut();
		        },2000);

		    });


			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.      GUI       _.~*~._.~*~._.~*~._.~*~._ \\
			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._ \\
			// _.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._.~*~._ \\
			
			var currentTool = "pen";
			var prevPen = "solid";
			var curColor = new BB.Color();

			$('#pen').on({ click:function(){ 
				hideSubmenu('pen');
				toggle('#submenu-pen');
				mainSelect(this);
				// mods
				currentTool = "pen";
				pen.color.copy( curColor );
				pen.variant = prevPen;

			}});
				$('#pensolid').on({click:function(){ subSelect(this, 'pen', 'solid');  }});
				$('#pensoft').on({click:function(){ subSelect(this, 'pen', 'soft');  }});
				$('#pencalig').on({click:function(){ subSelect(this, 'pen', 'calligraphy');  }});
				$('#penlines').on({click:function(){ subSelect(this, 'pen', 'lines');  }});


			$('#stamp').on({ click:function(){ 
				hideSubmenu('stamp');
				toggle('#submenu-stamp');
				mainSelect(this);
				// mods
				stamp.color.copy( curColor );
				currentTool = "stamp";

			}}); 
				$('#stampcircles').on({click:function(){ subSelect(this, 'stamp', 'circles');  }});
				$('#stampcircslash').on({click:function(){ subSelect(this, 'stamp', 'circleslash');  }});
				$('#stampcube').on({click:function(){ subSelect(this, 'stamp', 'cube');  }});
				$('#stampflames').on({click:function(){ subSelect(this, 'stamp', 'flames');  }});
				$('#stampgrid').on({click:function(){ subSelect(this, 'stamp', 'grid');  }});
				$('#stampheart').on({click:function(){ subSelect(this, 'stamp', 'heart');  }});
				$('#stamplocking').on({click:function(){ subSelect(this, 'stamp', 'locking');  }});
				$('#stampseal').on({click:function(){ subSelect(this, 'stamp', 'seal');  }});
				$('#stampstar').on({click:function(){ subSelect(this, 'stamp', 'star');  }});


			$('#eraser').on({ click:function(){ 
				hideSubmenu();
				mainSelect(this);
				// mods
				currentTool = "eraser";
				prevPen = pen.variant;
				pen.variant = "solid";
				curColor.copy( pen.color );
				pen.color.setRGBA( 255,255,255,255 );
			}});

			$('#colorpicker').on({ click:function(){ 
				hideSubmenu();
				mainSelect(this);
				// mods
				currentTool = "picker";
			}});


			// gui functions

			function hideSubmenu( exception ){
				if( $('#submenu-pen').css('display')!='none'   && exception!='pen' )    $('#submenu-pen').toggle('slide');
				if( $('#submenu-stamp').css('display')!='none' && exception!='stamp' )  $('#submenu-stamp').toggle('slide');
				// if( $('#submenu-spray').css('display')!='none' && exception!='spray' )  $('#submenu-spray').toggle('slide');
			}

			function toggle( item ){
				if( $(item).css('display')=='none' )  $(item).toggle('slide');
			}

			function mainSelect( ele ){
				$(".icon").each(function(){ $(this).css('opacity',0.5); });
				$(ele).css('opacity',1);
			}

			function subSelect( ele, tool, vrnt ){
				$(ele).parent().children().each(function(){ $(this).css('opacity',0.5) });
				$(ele).css('opacity',1);
				// mods
				if( tool == "stamp" && vrnt !== "undefined") stamp.variant = vrnt;
				if( tool == "pen" && vrnt !== "undefined") pen.variant = vrnt;
			}

			// hid all submenus by default
			$('#submenu-pen').toggle('slide');
			$('#submenu-stamp').toggle('slide'); 

			
			// -- color mods
			
			$('#colbar').on({click:function(e){
				// choose color from bar on left
				var deg = BB.MathUtils.map(e.pageY,0,window.innerHeight,0,360);
				pen.color.h = deg;
				stamp.color.copy( pen.color );
				curColor.copy( pen.color );
			}})

			$( window ).on({click:function(e){
				// choose color from canvas when picker tool is selected 
				if( currentTool == "picker" ){
					var p = ctx.getImageData(e.pageX, e.pageY, 1, 1).data; 
					pen.color.setRGBA( p[0], p[1], p[2], p[3] );
					stamp.color.setRGBA( p[0], p[1], p[2], p[3] );
				}
			}});





		</script>
	</body>
</html>