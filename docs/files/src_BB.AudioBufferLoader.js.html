<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\BB.AudioBufferLoader.js - liBB.js</title>
        
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/prettify-nick.css">

    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    
    <script src="../assets/vendor/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <div id="bd" class="main-body">

        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list">
                <div id="api-tabview" class="tabview">
                    <ul class="tabs">
                        <a href="/docs">
                            <img src="../assets/favicon.png" class="icon"/>
                        </a>
                        <a href="/docs" class="homelink"> liBB.js </a>
                        <!-- <li><a href="#api-classes">Classes</a></li> -->
                        <!-- <li><a href="#api-modules">Modules</a></li> -->
                    </ul>
            
                    <div id="api-tabview-filter">
                        <input type="search" id="api-filter" placeholder="Type to filter APIs">
                    </div>
            
                    <div id="api-tabview-panel">
                        <ul id="api-classes" class="apis classes">
                            <li><a class="type" href="../classes/BB.AudioAnalyser.html">BB.AudioAnalyser</a></li>
                            <li><a class="type" href="../classes/BB.AudioBufferLoader.html">BB.AudioBufferLoader</a></li>
                            <li><a class="type" href="../classes/BB.AudioSampler.html">BB.AudioSampler</a></li>
                            <li><a class="type" href="../classes/BB.AudioStream.html">BB.AudioStream</a></li>
                            <li><a class="type" href="../classes/BB.BaseBrush2D.html">BB.BaseBrush2D</a></li>
                            <li><a class="type" href="../classes/BB.BaseMidiInput.html">BB.BaseMidiInput</a></li>
                            <li><a class="type" href="../classes/BB.BrushManager2D.html">BB.BrushManager2D</a></li>
                            <li><a class="type" href="../classes/BB.Color.html">BB.Color</a></li>
                            <li><a class="type" href="../classes/BB.ImageBrush2D.html">BB.ImageBrush2D</a></li>
                            <li><a class="type" href="../classes/BB.LineBrush2D.html">BB.LineBrush2D</a></li>
                            <li><a class="type" href="../classes/BB.MathUtils.html">BB.MathUtils</a></li>
                            <li><a class="type" href="../classes/BB.MidiDevice.html">BB.MidiDevice</a></li>
                            <li><a class="type" href="../classes/BB.MidiInputButton.html">BB.MidiInputButton</a></li>
                            <li><a class="type" href="../classes/BB.MidiInputKey.html">BB.MidiInputKey</a></li>
                            <li><a class="type" href="../classes/BB.MidiInputKnob.html">BB.MidiInputKnob</a></li>
                            <li><a class="type" href="../classes/BB.MidiInputPad.html">BB.MidiInputPad</a></li>
                            <li><a class="type" href="../classes/BB.MidiInputSlider.html">BB.MidiInputSlider</a></li>
                            <li><a class="type" href="../classes/BB.MouseInput.html">BB.MouseInput</a></li>
                            <li><a class="type" href="../classes/BB.Particle2D.html">BB.Particle2D</a></li>
                            <li><a class="type" href="../classes/BB.Pointer.html">BB.Pointer</a></li>
                            <li><a class="type" href="../classes/BB.Vector2.html">BB.Vector2</a></li>
                        </ul>
            
                      <!--   <ul id="api-modules" class="apis modules">
                            <li><a class="module" href="../modules/BB.AudioAnalyser.html">BB.AudioAnalyser</a></li>
                            <li><a class="module" href="../modules/BB.AudioBufferLoader.html">BB.AudioBufferLoader</a></li>
                            <li><a class="module" href="../modules/BB.AudioSampler.html">BB.AudioSampler</a></li>
                            <li><a class="module" href="../modules/BB.AudioStream.html">BB.AudioStream</a></li>
                            <li><a class="module" href="../modules/BB.BaseBrush2D.html">BB.BaseBrush2D</a></li>
                            <li><a class="module" href="../modules/BB.BaseMidiInput.html">BB.BaseMidiInput</a></li>
                            <li><a class="module" href="../modules/BB.BrushManager2D.html">BB.BrushManager2D</a></li>
                            <li><a class="module" href="../modules/BB.Color.html">BB.Color</a></li>
                            <li><a class="module" href="../modules/BB.ImageBrush2D.html">BB.ImageBrush2D</a></li>
                            <li><a class="module" href="../modules/BB.LeapMotion.html">BB.LeapMotion</a></li>
                            <li><a class="module" href="../modules/BB.LineBrush2D.html">BB.LineBrush2D</a></li>
                            <li><a class="module" href="../modules/BB.MathUtils.html">BB.MathUtils</a></li>
                            <li><a class="module" href="../modules/BB.Midi.html">BB.Midi</a></li>
                            <li><a class="module" href="../modules/BB.MouseInput.html">BB.MouseInput</a></li>
                            <li><a class="module" href="../modules/BB.particle2D.html">BB.particle2D</a></li>
                            <li><a class="module" href="../modules/BB.Pointer.html">BB.Pointer</a></li>
                            <li><a class="module" href="../modules/BB.Vector2.html">BB.Vector2</a></li>
                        </ul> -->
                    </div>
                </div>
            </div>
        </div>

        <div id="docs-main" class="apidocs">
            <div class="content container">
    <h1 class="file-heading">File: src\BB.AudioBufferLoader.js</h1>
    
    <div class="file">
    <pre class="code prettyprint overflow linenums">
    /**
     * A module for creating audio buffers from audio files
     * @module BB.AudioBufferLoader
     */
    define([&#x27;./BB&#x27;],
    function(  BB){
    
        &#x27;use strict&#x27;;
        
        /**
         * A module for creating audio buffers from audio files
         * @class BB.AudioBufferLoader
         * @constructor
         * @param {Object} config A config object to initialize the buffer ( context:AudioContext, paths: Array of file paths, autoload:boolean)
         * @param {Function} [callback] A callback, with a buffer Object
         * @example  
         * &lt;code class=&quot;code prettyprint&quot;&gt;  
         * &amp;nbsp;var context =  new (window.AudioContext || window.webkitAudioContext)();&lt;br&gt;
         * &lt;br&gt;
         * &amp;nbsp;// one way to do it&lt;br&gt;
         * &amp;nbsp;var loader = new BufferLoader({&lt;br&gt;
         * &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;context: context,&lt;br&gt;
         * &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;paths: [&#x27;audio/katy.ogg&#x27;,&#x27;audio/entro.ogg&#x27;]&lt;br&gt;
         * &amp;nbsp;}, function(buffers){&lt;br&gt;
         * &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;console.log(&#x27;loaded:&#x27;, buffers )&lt;br&gt;
         * &amp;nbsp;});&lt;br&gt;
         * &lt;br&gt;
         * &amp;nbsp;// another way to do it&lt;br&gt;
         * &amp;nbsp;loader = new BufferLoader({ &lt;br&gt;
         * &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;context:context, &lt;br&gt;
         * &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;paths:[&#x27;katy.ogg&#x27;,&#x27;entro.ogg&#x27;], &lt;br&gt;
         * &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;autoload:false &lt;br&gt;
         * &amp;nbsp;});&lt;br&gt;
         * &amp;nbsp;loader.load(); // call load later, ex under some other condition&lt;br&gt;
         * &lt;/code&gt;
         */
    
    
        BB.AudioBufferLoader = function( config, callback ){
            
            /**
             * corresponding Audio Context
             * @type {AudioContext}
             * @property ctx
             */
            this.ctx        = config.context;
    
            /**
             * array of paths to audio files to load 
             * @type {Array}
             * @property urls
             */
            this.urls       = config.paths;
    
            /**
             * whether or not to autoload the files
             * @type {Boolean}
             * @property auto
             */
            this.auto       = ( typeof config.autoload !== &#x27;undefined&#x27; ) ? config.autoload : true;
    
            /**
             * callback to run after loading
             * @type {Function}
             * @property onload
             */
            this.onload     = callback;
            
            this._cnt       = 0; // to know when to callback
    
            /**
             * audio buffers array, accessible in callback
             * @type {Array}
             * @property buffers
             */
            this.buffers    = [];
    
            if( !config ) throw new Error(&#x27;BB.AudioBufferLoader: requires a config object&#x27;);
    
            if( !(this.ctx instanceof AudioContext) ) 
                throw new Error(&#x27;BB.AudioBufferLoader: context should be an instance of AudioContext&#x27;);
            
            if( !(this.urls instanceof Array) ) 
                throw new Error(&#x27;BB.AudioBufferLoader: paths should be an Array of paths&#x27;);
            
            if( typeof this.auto !== &#x27;boolean&#x27; ) 
                throw new Error(&#x27;BB.AudioBufferLoader: autoload should be either true or false&#x27;);
    
            if( this.auto===true ) this.load();
        };
    
        /**
         * private function used by load() to load a buffer
         * @method loadbuffer
         * @param {String} path to audio file 
         * @param {Number} index of buffer 
         */
        BB.AudioBufferLoader.prototype.loadbuffer = function(url, index){
            var self = this;
    
            // create rootpath to get around bug ( which seems to have gone away? )
            // var fullpath = window.location.pathname;
            // var filename = fullpath.replace(/^.*[\\\/]/, &#x27;&#x27;);
            // var rootpath = fullpath.substring(0,fullpath.length-filename.length);
            
            // http://www.html5rocks.com/en/tutorials/webaudio/intro/#toc-load  
            var req = new XMLHttpRequest();
                req.open(&#x27;GET&#x27;, url, true);
                req.responseType = &#x27;arraybuffer&#x27;;
                req.onload = function(){
    
                    self.ctx.decodeAudioData( req.response, function(decodedData){ 
                        // https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/decodeAudioData
                        if(!decodedData) throw new Error(&#x27;BB.AudioBufferLoader: decodeAudioData: could not decode: &#x27; + url );
                        
                        self.buffers[index] = decodedData;
                        
                        if( ++self._cnt == self.urls.length &amp;&amp; typeof self.onload !==&#x27;undefined&#x27;) 
                            self.onload( self.buffers ); // if callback do callback 
                    
                    },function(err){ throw new Error(&#x27;BB.AudioBufferLoader: decodeAudioData:&#x27;+err);});
                };
                req.onerror = function(){ throw new Error(&#x27;BB.AudioBufferLoader: XHMHttpRequest&#x27;); };
                req.send();
        };
    
        /**
         * creates buffers from url paths set in the constructor, automatically runs in constructor unless autoload is set to false
         * @method load
         */
        BB.AudioBufferLoader.prototype.load = function(){
            for (var i = 0; i &lt; this.urls.length; i++) this.loadbuffer( this.urls[i], i );
        };   
    
        return BB.AudioBufferLoader;
    });
    </pre>
    </div>
            </div>
        </div>

    </div>
</div>

<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>

<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
